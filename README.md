# Площадка предварительного заказа онлайн в фастфуде

## 1. Техническое задание

### 1.1 Назначение системы

Сервис должен обеспечивать возможность оформления предварительных заказов в фастфуде: клиент должен иметь возможность выбрать позиции меню, сформировать заказ, указать точку самовывоза и время получения. Система должна сокращать время ожидания на точке выдачи.

### 1.2 Роли пользователей

**Клиент должен иметь возможность:**

* просматривать категории и позиции меню;
* собирать заказ;
* указывать номер телефона и точку самовывоза;
* получать статус заказа.

### 1.3 Функциональные требования

#### 1. Управление клиентами

Система должна поддерживать:

* создание клиента по номеру телефона;
* получение клиента по ID.

#### 2. Управление меню

Система должна поддерживать:

* создание категории меню;
* создание позиции меню (цена, активность, описание, категория);
* получение списка категорий и позиций.

#### 3. Управление заказами

Система должна обеспечивать:

* создание заказа (клиент, список позиций, количество);
* хранение статусов заказа (`NEW`, `IN_PROGRESS`, `READY`, `CLOSED`, `CANCELED`);
* расчет итоговой стоимости;
* назначение точки выдачи и времени получения.

#### 4. API и интеграции

Система должна предоставлять:

* gRPC API;
* HTTP-gateway для REST-доступа;
* Swagger/OpenAPI-спецификации.

---

## 2. Прототип пользовательского интерфейса

Должен быть реализован прототип пользовательского интерфейса (файл `images/order-service-ui.png`), включающий следующие экраны:

* каталог меню;
* корзина и оформление заказа;
* экран статуса заказа;
* экран списка заказов;
* карточки товаров.

---

## 3. Схема базы данных и SQL-объекты

### 3.1 Логическая схема БД

Должна быть спроектирована логическая схема базы данных (Mermaid-диаграмма в `images/order-service-db.png`).

### 3.2 Скрипты создания БД

Необходимо подготовить SQL-скрипты миграций для создания структуры БД:

* таблицы в файлах `db/migrations/001..006_*.sql`.

---

## 4. Реализация системы

Сервис должен быть реализован на языке Go со следующей структурой проекта:

* точка входа: `cmd/service-order/main.go`;
* слой бизнес-логики: `internal/usecase/*`;
* gRPC-обработчики: `internal/handlers/*`;
* репозитории PostgreSQL: `internal/repository/postgres/*`;
* API-контракты: `api/*.proto`;
* сгенерированный код: `generated/`.

---

## 5. Развертывание и CI/CD

### Docker / docker-compose

Необходимо обеспечить конфигурацию окружения через `docker-compose.yml` со следующими профилями:

* базовый — сервис заказов + PostgreSQL;
* `infra` — Kafka + ClickHouse;
* `monitoring` — Prometheus + Grafana.

### CI/CD

Должен быть настроен pipeline (`.github/workflows/deploy-with-ansible.yml`), выполняющий:

1. сборку и публикацию Docker-образа;
2. деплой на сервер с помощью Ansible playbook.

---

## 6. Мониторинг и уведомления

Необходимо реализовать систему мониторинга, включающую:

* provisioning datasource, dashboards и alert-правил Grafana (`infra/grafana/provisioning/*`);
* dashboard JSON (`infra/grafana/dashboards/dashboard.json`).

Должны быть настроены алерты:

* `ServiceDown` — сервис недоступен;
* `HighErrorRate` — превышение допустимого уровня ошибок.

---

## 7. Интеграция Kafka и ClickHouse

Необходимо реализовать поток обработки данных (`infra/clickhouse/init/01_kafka_pipeline.sql`), включающий:

1. таблицу Kafka Engine `analytics.numbers_stream`, читающую топик `numbers`;
2. Materialized View `mv_numbers_to_parsed` для обработки корректных `Int64` значений в таблицу `numbers_parsed`;
3. Materialized View `mv_numbers_to_dlq_topic` для отправки некорректных сообщений в DLQ-топик (`numbers-dlq`);
4. Materialized View `mv_dlq_topic_to_table` для сохранения сообщений DLQ в таблицу `numbers_dlq`;
5. Materialized View `mv_sum_by_sign` для расчета агрегатов сумм положительных и отрицательных чисел.

## 8. SQL - 10 заданий простой, 10 средней, 10 сложной с сайта http://stratascratch.com/
Профиль: https://platform.stratascratch.com/user/ED
